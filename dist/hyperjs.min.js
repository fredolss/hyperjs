"use strict";(()=>{var c=class extends Error{constructor(t,r,s,i){super(s);this.url=t;this.status=r;this.statusText=s;this.data=i;this.name="HttpError"}};async function d(n){let e;try{e=await R(n)}catch(t){throw new c(n.url,t.status,t.statusText,t.responseText)}if(e&&e.length>0)return JSON.parse(e)}function R(n){return new Promise(function(e,t){var r=new XMLHttpRequest;r.open(n.method,n.url),r.onload=function(){this.status>=200&&this.status<300?e(r.responseText):t({status:this.status,statusText:r.statusText})},r.onerror=function(){t({responseText:r.responseText,status:this.status,statusText:r.statusText})},n.headers&&Object.keys(n.headers).forEach(function(i){r.setRequestHeader(i,n.headers[i])});var s=n.data;s&&typeof s=="object"&&(s=Object.keys(s).map(function(i){return encodeURIComponent(i)+"="+encodeURIComponent(s[i])}).join("&")),r.send(s)})}var o=class extends Error{constructor(t){super(`link: "${t}" not found`);this.rel=t;this.name="LinkNotFoundError"}};var u=class extends Error{constructor(e){super(`resource ${e} not loaded`),this.name="ResourceNotLoadedError"}};var l=class extends Error{constructor(){super("url must be set"),this.name="UrlMustBeSetError"}};function p(n,e,t){if(typeof n>"u")throw new l;if(typeof e<"u")for(let r in e)e.hasOwnProperty(r)&&(n=n.replace("{"+r+"}",encodeURIComponent(e[r])));if(typeof t<"u"){for(let r in t)if(t.hasOwnProperty(r)){n.indexOf("?")===-1?n+="?":n+="&";let s=t[r];Array.isArray(s)===!1&&(s=[s]);for(let i of s)n+=r+"="+encodeURIComponent(i)}}return n.replace(new RegExp("#","g"),"%23")}var y=class n{constructor(e,t,r){this.linkMethod=e;this.parentResource=t;this.client=r}resource;async fetch(e){if(this.resource)return this.resource.fetch(e);await this.parentResource.fetch();let t=this.linkMethod();return this.resource=this.client.getResource(t.href),await this.resource.fetch(e),this.resource}get data(){return this.resource.data}put(e,t){return this.resource.put(e,t)}patch(e,t){return this.resource.patch(e,t)}post(e,t){return this.resource.post(e,t)}delete(e,t){return this.resource.delete(e,t)}action(e,t,r){return this.resource.action(e,t,r)}followLink(e,t,r){if(this.resource&&typeof this.resource.data<"u")return this.resource.followLink(e,t);let s=()=>{let i=this.resource.data,a=this.client.getLink(e,i);if(typeof a>"u")throw new o(e);return{href:p(a,t,r),rel:e,method:"GET"}};return new n(s,this,this.client)}getLink(e){return this.resource.getLink(e)}hasLink(e){return this.resource.hasLink(e)}},h=class{resourceUrl;resource;client;constructor(e){if(typeof e>"u")throw new Error("resourceParams must be set");if(typeof e.client>"u")throw new Error("client must be set");this.client=e.client,typeof e.resource<"u"?(this.resource=e.resource,this.resourceUrl=this.client.getSelf(this.resource)):this.resourceUrl=e.url}async fetch(e,t){let s={method:"GET",url:p(this.resourceUrl,e,t)};return this.resource=await this.makeRequest(s),this}get data(){return this.resource}async post(e,t){return await this._action(this.resourceUrl,"POST",e)}async put(e,t){return await this._action(this.resourceUrl,"PUT",e)}async patch(e,t){return await this._action(this.resourceUrl,"PATCH",e)}async delete(e,t){return await this._action(this.resourceUrl,"DELETE",e)}async action(e,t,r,s){let i=this.getLink(e);if(!i)throw new o(e);let a=p(i.href,s);return await this._action(a,t,r)}async _action(e,t,r){let i={method:t,url:e,headers:{},data:JSON.stringify(r),contentType:"application/json; charset=utf-8"};return this.makeRequest(i)}async makeRequest(e){let t=this.client.getRequestOptions(this,e);if(typeof t<"u"&&(typeof t.method<"u"&&(e.method=t.method),t.headers)){typeof e.headers>"u"&&(e.headers={});for(let r in t.headers)e.headers[r]=t.headers[r]}return await d(e)}getLink(e){if(typeof this.resource>"u")throw new u(this.resourceUrl);return{rel:e,href:this.client.getLink(e,this.resource)}}hasLink(e){return typeof this.getLink(e)<"u"}followLink(e,t,r){let s=()=>{if(typeof this.resource>"u")throw new u(this.resourceUrl);let a=this.client.getLink(e,this.resource);return{href:p(a,t,r),rel:e,method:"GET"}};if(typeof this.resource>"u")return new y(s,this,this.client);let i=s();this.client.getResource(i.href)}};function v(){return new f}var f=class{_getSelf;_getLink;_withRequestOptions;withSelfCallback=e=>(this._getSelf=e,this);withLinkCallback=e=>(this._getLink=e,this);withRequestOptions=e=>(this._withRequestOptions=e,this);getRequestOptions=(e,t)=>typeof this._withRequestOptions!="function"?t:this._withRequestOptions(e,t);getSelf=e=>this._getSelf(e);getLink=(e,t)=>this._getLink(e,t);constructor(){}getResource(e){return new h({url:e,client:this})}wrapResource(e){return new h({resource:e,client:this})}};})();
